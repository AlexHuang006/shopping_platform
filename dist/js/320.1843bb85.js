"use strict";(self["webpackChunkshopping_platform"]=self["webpackChunkshopping_platform"]||[]).push([[320],{1320:function(t,s,a){a.r(s),a.d(s,{default:function(){return g}});a(4114);var i=function(){var t=this,s=t._self._c;return s("div",{staticClass:"prodetail"},[s("van-nav-bar",{attrs:{fixed:"",title:"商品详情","left-arrow":""},on:{"click-left":function(s){return t.$router.go(-1)}}}),t.loading?t._e():s("div",[s("van-swipe",{attrs:{autoplay:3e3},on:{change:t.onChange},scopedSlots:t._u([{key:"indicator",fn:function(){return[s("div",{staticClass:"custom-indicator"},[t._v(t._s(t.current+1)+" / "+t._s(t.images.length))])]},proxy:!0}],null,!1,3958565683)},t._l(t.images,(function(t,a){return s("van-swipe-item",{key:a},[s("img",{attrs:{src:t.external_url}})])})),1),s("div",{staticClass:"info"},[s("div",{staticClass:"title"},[s("div",{staticClass:"price left"},[s("span",{staticClass:"now"},[t._v("￥"+t._s(t.detail.goods_price_min))]),s("span",{staticClass:"oldprice"},[t._v("￥"+t._s(t.detail.goods_price_max))])]),s("div",{staticClass:"sellcount right"},[t._v("已售"+t._s(t.detail.goods_sales)+"件")])]),s("div",{staticClass:"msg text-ellipsis-2"},[t._v(" "+t._s(t.detail.goods_name)+" ")]),s("div",{staticClass:"service"},[s("div",{staticClass:"left-words"},[s("span",[s("van-icon",{attrs:{name:"passed"}}),t._v("七天无理由退货")],1),s("span",[s("van-icon",{attrs:{name:"passed"}}),t._v("48小时发货")],1)]),s("div",{staticClass:"right-icon"},[s("van-icon",{attrs:{name:"arrow"}})],1)])]),s("div",{staticClass:"comment"},[s("div",{staticClass:"comment-title"},[s("div",{staticClass:"left"},[t._v("商品评价 ("+t._s(t.total)+"条)")]),t.total>0?s("div",{staticClass:"right"},[t._v("查看更多 "),s("van-icon",{attrs:{name:"arrow"}})],1):t._e()]),s("div",{staticClass:"comment-list"},t._l(t.commentList,(function(a){return s("div",{key:a.comment_id,staticClass:"comment-item"},[s("div",{staticClass:"top"},[s("img",{attrs:{src:a.user.avatar_url||t.defaultImg,alt:""}}),s("div",{staticClass:"name"},[t._v(t._s(a.user.nick_name))]),s("van-rate",{attrs:{size:16,value:a.score/2,color:"#ffd21e","void-icon":"star","void-color":"#eee"}})],1),s("div",{staticClass:"content"},[t._v(" "+t._s(a.content)+" ")]),s("div",{staticClass:"time"},[t._v(" "+t._s(a.create_time)+" ")])])})),0)]),s("div",{staticClass:"desc",domProps:{innerHTML:t._s(t.detail.content)}}),s("div",{staticClass:"footer"},[s("div",{staticClass:"icon-home",on:{click:function(s){return t.$router.push("/home")}}},[s("van-icon",{attrs:{name:"wap-home-o"}}),s("span",[t._v("Home")])],1),s("div",{staticClass:"icon-cart",on:{click:function(s){return t.$router.push("/cart")}}},[t.cartTotal>0?s("span",{staticClass:"num"},[t._v(t._s(t.cartTotal>99?"99+":t.cartTotal))]):t._e(),s("van-icon",{attrs:{name:"shopping-cart-o"}}),s("span",[t._v("Cart")])],1),s("div",{staticClass:"btn-add",on:{click:t.addFn}},[t._v("Add to cart")]),s("div",{staticClass:"btn-buy",on:{click:t.buyFn}},[t._v("Buy now")])]),s("van-action-sheet",{attrs:{title:"cart"===t.model?"Add to cart":"Buy now"},model:{value:t.showPanel,callback:function(s){t.showPanel=s},expression:"showPanel"}},[s("div",{staticClass:"product"},[s("div",{staticClass:"product-title"},[s("div",{staticClass:"left"},[s("img",{attrs:{src:t.detail.goods_image,alt:""}})]),s("div",{staticClass:"right"},[s("div",{staticClass:"price"},[s("span",[t._v("¥")]),s("span",{staticClass:"nowprice"},[t._v(t._s(t.detail.goods_price_min))]),s("span",{staticClass:"oldprice"},[t._v("¥ "+t._s(t.detail.goods_price_max))])]),0===t.detail.stock_total?s("div",{staticClass:"count"},[s("span",[t._v("库存")]),s("span",[t._v(t._s(t.detail.stock_total))])]):t._e()])]),t.detail.stock_total>0?s("div",{staticClass:"num-box"},[s("span",[t._v("Qty")]),s("CountBox",{attrs:{proStock:t.detail.stock_total},model:{value:t.addCount,callback:function(s){t.addCount=s},expression:"addCount"}})],1):t._e(),t.detail.stock_total>0?s("div",{staticClass:"showbtn"},["cart"===t.model?s("div",{staticClass:"btn",on:{click:t.addCart}},[t._v("Add to cart")]):s("div",{staticClass:"btn now",on:{click:t.goBuyNow}},[t._v("Buy now")])]):s("div",{staticClass:"btn-none"},[t._v("Sold out")])])])],1)],1)},o=[],e=a(3395),n=a(7767),c=a(6029),d=a(6092),l=a(1910),r=a(2823),u={name:"ProDetailIndex",mixins:[r.A],components:{CountBox:c.A},data(){return{current:0,images:[],detail:[],total:0,commentList:[],defaultImg:n,loading:!0,showPanel:!1,model:"cart",addCount:1}},computed:{goodsId(){return this.$route.params.id},...(0,l.L8)("cart",["cartTotal"])},created(){this.getDetail(),this.getComments(),this.$store.getters.token&&this.$store.dispatch("cart/getCartAction")},methods:{onChange(t){this.current=t},async getDetail(){const{data:{detail:t}}=await(0,e.B7)(this.goodsId);this.detail=t,this.images=t.goods_images},async getComments(){const{data:{list:t,total:s}}=await(0,e.Yv)(this.goodsId,3);this.commentList=t,this.total=s,this.loading=!1},addFn(){this.model="cart",this.showPanel=!0},buyFn(){this.model="butNow",this.showPanel=!0},async addCart(){this.loginConfirm()||(await(0,d.U4)(this.goodsId,this.addCount,this.detail.skuList[0].goods_sku_id),this.$store.dispatch("cart/getCartAction"),this.$toast("添加成功"),this.showPanel=!1)},goBuyNow(){this.loginConfirm()||this.$router.push({path:"/pay",query:{mode:"buyNow",goodsId:this.goodsId,goodsSkuId:this.detail.skuList[0].goods_sku_id,goodsNum:this.addCount}})}}},v=u,m=a(1656),_=(0,m.A)(v,i,o,!1,null,"5e7268e4",null),g=_.exports},3395:function(t,s,a){a.d(s,{B7:function(){return e},Cd:function(){return o},Yv:function(){return n}});var i=a(7120);const o=t=>{const{sortType:s,SortPrice:a,categoryId:o,goodsName:e,page:n}=t;return i.A.get("/goods/list",{params:{sortType:s,SortPrice:a,categoryId:o,goodsName:e,page:n}})},e=t=>i.A.get("/goods/detail",{params:{goodsId:t}}),n=(t,s)=>i.A.get("/comment/listRows",{params:{goodsId:t,limit:s}})}}]);
//# sourceMappingURL=320.1843bb85.js.map